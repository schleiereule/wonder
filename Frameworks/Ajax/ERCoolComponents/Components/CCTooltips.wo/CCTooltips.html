<webobject name = "opentipCss" />
<webobject name = "opentipJs" />
<webobject name = "isPolyfillRequired"><webobject name = "mutationObserverPolyfill"/></webobject>
<script type = "text/javascript">
  Opentip.styles.wonder = {
    escapeContent: true,
    escapeTitle: true,
    extends: 'glass',
   	fixed: true
  };
  Opentip.defaultStyle = 'wonder';

  function addOpentips() {
      // collect all candidates, i.e. elements matching the target class
      var candidates = document.getElementsByClassName('<webobject name = "TargetClass"/>');
      for (i = 0; i < candidates.length; i++) { 
	  	var candidate = candidates[i];
	  	var isCandidateOverflowing = candidate.offsetWidth < candidate.scrollWidth;
	  	var isParentOverflowing = candidate.parentElement.offsetWidth < candidate.parentElement.scrollWidth;
  		var hasOpentip = candidate.getAttribute('data-id') != undefined;
	  	// only add a tooltip for elements that are overflowing and have no title attribute set
	  	if ((isCandidateOverflowing || isParentOverflowing) && !candidate.title && !hasOpentip) {
   			new Opentip(candidate, candidate.textContent, {});
	    }
	    // TODO handle removal of opentip when the element does not overflow after a resize,
	    // which unfortunately is nigh on impossible with the current opentip API - even
	    // deleting the DOM elements for created opentips does not help, as this won't get
	    // rid of opentips that were not yet rendered
	  }
  };

  function addObserver() {
  	// apply tooltips to any span elements created via Ajax
  	MutationObserver = window.MutationObserver || window.WebKitMutationObserver;
  	var observer = new MutationObserver(function(mutations) {
      	addOpentips();
  	});
	var mainContentDiv = document.getElementById('MainContent');
	observer.observe(mainContentDiv, {childList: true, subtree: true});
  };

  document.addEventListener("DOMContentLoaded", addOpentips, false);
  document.addEventListener("DOMContentLoaded", addObserver, false);
  window.addEventListener('resize', addOpentips, false);
</script>